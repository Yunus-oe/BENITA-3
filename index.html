<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Türkisch-Lernplattform — Schnelltest</title>
  <style>
    /* sehr einfache Styles, kein Tailwind nötig */
    body { font-family: Arial, system-ui, -apple-system; padding: 18px; background:#f8fafc; color:#111827; }
    .container { max-width:900px; margin:0 auto; background:white; padding:18px; border-radius:8px; box-shadow:0 1px 6px rgba(0,0,0,.06); }
    h1{font-size:22px;margin-bottom:12px}
    .controls{display:flex;gap:8px;margin-bottom:12px}
    button{padding:6px 10px;border-radius:6px;border:1px solid #e5e7eb;background:#f3f4f6;cursor:pointer}
    .btnPrimary{background:#0ea5a4;color:white;border:none}
    input, textarea{padding:8px;border:1px solid #d1d5db;border-radius:6px;width:100%}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .list li{padding:8px;border:1px solid #e6e9ee;border-radius:6px;margin-bottom:6px;display:flex;justify-content:space-between;align-items:center}
    .small{font-size:13px;color:#6b7280}
  </style>
</head>
<body>
  <div class="container" id="root"></div>

  <!-- React + ReactDOM (UMD) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel für JSX im Browser (nur für schnellen Prototyp) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect } = React;

    function TurkishLearner() {
      const [pairs, setPairs] = useState(() => {
        try { return JSON.parse(localStorage.getItem('tl_pairs')) || []; } catch { return []; }
      });
      const [turkishInput, setTurkishInput] = useState('');
      const [germanInput, setGermanInput] = useState('');
      const [step, setStep] = useState(0);
      const [quizOrder, setQuizOrder] = useState([]);
      const [answers, setAnswers] = useState({});
      const [results, setResults] = useState(null);
      const [generatedText, setGeneratedText] = useState('');
      const [blanks, setBlanks] = useState({});
      const [customText, setCustomText] = useState('');

      useEffect(() => { localStorage.setItem('tl_pairs', JSON.stringify(pairs)); }, [pairs]);

      function addPair() {
        const t = turkishInput.trim(), g = germanInput.trim();
        if(!t || !g) return;
        setPairs(p => [...p, { t,g }]);
        setTurkishInput(''); setGermanInput('');
      }
      function removePair(i){ setPairs(p => p.filter((_,idx) => idx !== i)); }
      function shuffle(a){ return a.slice().sort(()=>Math.random()-0.5); }

      function startQuiz(){
        if(pairs.length===0) return;
        const order = pairs.map((_,i)=>i).sort(()=>Math.random()-0.5);
        setQuizOrder(order); setAnswers({}); setResults(null); setStep(2);
      }
      function submitQuiz(){
        const res = { correct:0, total:quizOrder.length, detail:[] };
        quizOrder.forEach(idx=>{
          const expected = pairs[idx].t.toLowerCase();
          const got = (answers[idx]||'').trim().toLowerCase();
          const ok = expected === got;
          if(ok) res.correct++;
          res.detail.push({ idx, expected:pairs[idx].t, got, ok });
        });
        setResults(res);
      }

      function autoGenerateLueckentext(){
        if(pairs.length===0) return;
        const words = pairs.map(p=>p.t);
        const germanFragments = ["Wir sind im Urlaub und","Am Abend sitze ich am Fenster,","Du lachst leise,","Und ich denke an"];
        const pickCount = Math.min(4, words.length);
        const picked = shuffle([...words]).slice(0,pickCount);
        let sentences = picked.map((w,i)=> `${germanFragments[i%germanFragments.length]} ${w}.`);
        const paragraph = sentences.join(' ');
        const mapping = {};
        let textWithBlanks = paragraph;
        picked.forEach((w,i)=>{
          const token = `__[${i+1}]__`;
          textWithBlanks = textWithBlanks.replace(w, token);
          mapping[i+1] = w;
        });
        setGeneratedText(textWithBlanks); setBlanks(mapping); setStep(3);
      }

      function parseCustomToBlanks(){
        const regex = /{{\s*([^}]+?)\s*}}/g;
        const map = {}; let m; let i=1; let newText = customText;
        while((m=regex.exec(customText))!==null){
          map[i] = m[1];
          newText = newText.replace(m[0], `__[${i}]__`);
          i++;
        }
        if(Object.keys(map).length===0){ alert('Keine Platzhalter {{...}} gefunden.'); return; }
        setGeneratedText(newText); setBlanks(map); setStep(3);
      }

      return (
        <div>
          <h1>Türkisch Lernplattform — Prototyp</h1>

          <div className="controls">
            <button onClick={()=>setStep(0)}>Editieren</button>
            <button onClick={()=>setStep(1)}>Lernen</button>
            <button onClick={startQuiz}>Abfrage</button>
            <button onClick={autoGenerateLueckentext}>Lückentext (Auto)</button>
          </div>

          {step===0 && (
            <section>
              <div className="grid2">
                <input placeholder="Türkisch (z.B. merhaba)" value={turkishInput} onChange={e=>setTurkishInput(e.target.value)} />
                <input placeholder="Deutsch (z.B. Hallo)" value={germanInput} onChange={e=>setGermanInput(e.target.value)} />
              </div>
              <div style={{marginTop:10, display:'flex', gap:8}}>
                <button className="btnPrimary" onClick={addPair}>Hinzufügen</button>
                <button onClick={()=>setPairs([])}>Alle löschen</button>
                <button onClick={()=>{
                  const blob = new Blob([JSON.stringify(pairs,null,2)],{type:'application/json'});
                  const url = URL.createObjectURL(blob);
                  const a = document.createElement('a'); a.href = url; a.download = 'turkish_pairs.json'; a.click();
                  URL.revokeObjectURL(url);
                }}>Export</button>
                <label style={{padding:'6px 10px', background:'#fde68a', borderRadius:6, cursor:'pointer'}}>
                  Import
                  <input type="file" accept="application/json" onChange={e=>{
                    const f = e.target.files?.[0]; if(!f) return;
                    const r = new FileReader(); r.onload = ev=>{
                      try{ const data = JSON.parse(ev.target.result); if(Array.isArray(data)) setPairs(data.slice(0,50)); }catch{ alert('Fehler beim Einlesen'); }
                    }; r.readAsText(f);
                  }} style={{display:'none'}}/>
                </label>
              </div>

              <h3 style={{marginTop:12}}>Wortliste ({pairs.length})</h3>
              <ul className="list">
                {pairs.map((p,i)=>(
                  <li key={i}>
                    <div><strong>{p.t}</strong> — <span className="small">{p.g}</span></div>
                    <div style={{display:'flex',gap:6}}>
                      <button onClick={()=>navigator.clipboard?.writeText(p.t)}>Kopieren</button>
                      <button onClick={()=>removePair(i)}>Löschen</button>
                    </div>
                  </li>
                ))}
              </ul>
              <p className="small">Hinweis: Lokaler Speicher wird verwendet. Du kannst die Liste exportieren/importieren.</p>
            </section>
          )}

          {step===1 && (
            <section>
              <h2>Lerne die Liste</h2>
              <p className="small">Lies die Paare durch und klicke "Abfrage" wenn du bereit bist.</p>
              <div className="grid2">
                {pairs.map((p,i)=>(<div key={i} style={{padding:8,border:'1px solid #e5e7eb',borderRadius:6}}>{p.t} — {p.g}</div>))}
              </div>
            </section>
          )}

          {step===2 && (
            <section>
              <h2>Abfrage — schreibe das Türkische Wort</h2>
              <div style={{marginTop:8}}>
                {quizOrder.map(idx=>(
                  <div key={idx} style={{display:'flex',gap:8,alignItems:'center',marginBottom:8}}>
                    <div style={{width:160}}>{pairs[idx].g}</div>
                    <input value={answers[idx]||''} onChange={e=>setAnswers(a=>({...a,[idx]:e.target.value}))} />
                  </div>
                ))}
              </div>
              <div style={{marginTop:10,display:'flex',gap:8}}>
                <button onClick={submitQuiz} className="btnPrimary">Prüfen</button>
                <button onClick={()=>{setStep(1); setResults(null);}}>Zurück</button>
              </div>

              {results && (
                <div style={{marginTop:12,padding:8,border:'1px solid #e6f4ef',borderRadius:6}}>
                  Ergebnis: {results.correct} / {results.total}
                  <ul>
                    {results.detail.map((d,i)=>(<li key={i} style={{marginTop:6}}><strong>{pairs[d.idx].g}</strong> — Erwartet: {d.expected} | Du: {d.got} {d.ok ? '✅' : '❌'}</li>))}
                  </ul>
                </div>
              )}
            </section>
          )}

          {step===3 && (
            <section>
              <h2>Lückentext</h2>
              <div style={{marginTop:8, marginBottom:8}}>
                <button onClick={autoGenerateLueckentext}>Neu generieren</button>
                <button onClick={()=>{ setCustomText(''); setBlanks({}); setGeneratedText(''); setStep(0); }}>Zurück</button>
              </div>

              {generatedText ? (
                <LueckentextBlock text={generatedText} blanks={blanks} onCheck={res=>alert(`Ergebnis ${res.correct}/${res.total}`)} />
              ) : <div className="small">Kein Text generiert.</div>}

              <div style={{marginTop:12}}>
                <h3>Oder: eigenen Text schreiben</h3>
                <p className="small">Schreibe einen Text und markiere die türkischen Wörter mit {{wort}}</p>
                <textarea rows="4" value={customText} onChange={e=>setCustomText(e.target.value)} />
                <div style={{marginTop:8}}><button className="btnPrimary" onClick={parseCustomToBlanks}>Aus Text Lückentext machen</button></div>
              </div>
            </section>
          )}

        </div>
      );
    }

    function LueckentextBlock({ text, blanks, onCheck }) {
      const [user, setUser] = React.useState({});
      function handleChange(i, val) { setUser(u=>({...u,[i]:val})); }
      function doCheck(){ const res={correct:0,total:Object.keys(blanks).length}; for(const k of Object.keys(blanks)){ if(((user[k]||'').trim().toLowerCase())===((blanks[k]||'').trim().toLowerCase())) res.correct++; } onCheck(res); }
      const pieces = text.split(/(__\[\d+\]__)/g).filter(Boolean);
      return (
        <div>
          <p style={{padding:12,border:'1px solid #eef2ff',borderRadius:8, background:'#fbfdff'}}>
            {pieces.map((pc,i)=>{
              const m = pc.match(/__\[(\d+)\]__/);
              if(m){ const id=m[1]; return <span key={i}
